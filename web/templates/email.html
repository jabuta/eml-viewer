{{template "header" .}}

<div class="space-y-6">
    <!-- Back Button -->
    <div>
        <a
            href="/"
            class="inline-flex items-center text-sm text-gray-600 hover:text-gray-900"
        >
            <svg
                class="w-4 h-4 mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 19l-7-7 7-7"
                />
            </svg>
            Back to email list
        </a>
    </div>

    <!-- Email Header -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <h1 class="text-2xl font-bold text-gray-900 mb-4">
            {{.Email.Subject}}
        </h1>

        <div class="space-y-3 text-sm">
            <div class="flex">
                <span class="w-24 font-semibold text-gray-700">From:</span>
                <span class="flex-1 text-gray-900">
                    {{if .Email.SenderName}}{{.Email.SenderName}}
                    &lt;{{.Email.Sender}}&gt;{{else}}{{.Email.Sender}}{{end}}
                </span>
            </div>

            {{if .Email.Recipients}}
            <div class="flex">
                <span class="w-24 font-semibold text-gray-700">To:</span>
                <span class="flex-1 text-gray-900">{{.Email.Recipients}}</span>
            </div>
            {{end}} {{if .Email.CC}}
            <div class="flex">
                <span class="w-24 font-semibold text-gray-700">CC:</span>
                <span class="flex-1 text-gray-900">{{.Email.CC}}</span>
            </div>
            {{end}}

            <div class="flex">
                <span class="w-24 font-semibold text-gray-700">Date:</span>
                <span class="flex-1 text-gray-900">{{.Email.GetDate.Format "Mon, Jan 2, 2006 at 3:04 PM"}}</span>
            </div>
            </div>

            {{if .Email.HasAttachments}}
            <div class="flex">
                <span class="w-24 font-semibold text-gray-700"
                    >Attachments:</span
                >
                <span class="flex-1 text-gray-900"
                    >{{.Email.AttachmentCount}} file(s)</span
                >
            </div>
            {{end}}
        </div>

        <div class="mt-4 pt-4 border-t border-gray-200">
            <button
                onclick="document.getElementById('raw-headers').classList.toggle('hidden')"
                class="text-sm text-blue-600 hover:text-blue-700 font-medium"
            >
                Show/Hide Raw Headers
            </button>
        </div>

        <div id="raw-headers" class="hidden mt-4 pt-4 border-t border-gray-200">
            <pre class="text-xs bg-gray-50 p-4 rounded overflow-x-auto">
{{.Email.RawHeaders}}</pre
            >
        </div>
    </div>

    <!-- Email Body -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
        <div class="border-b border-gray-200">
            <nav class="flex -mb-px">
                {{if .Email.BodyHTML}}
                <button
                    onclick="showTab('html')"
                    id="tab-html"
                    class="tab-button border-b-2 border-blue-600 px-6 py-3 text-sm font-medium text-blue-600"
                >
                    HTML
                </button>
                <button
                    onclick="showTab('text')"
                    id="tab-text"
                    class="tab-button border-b-2 border-transparent px-6 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300"
                >
                    Plain Text
                </button>
                {{else}}
                <button
                    onclick="showTab('text')"
                    id="tab-text"
                    class="tab-button border-b-2 border-blue-600 px-6 py-3 text-sm font-medium text-blue-600"
                >
                    Plain Text
                </button>
                {{end}}
            </nav>
        </div>

        {{if .Email.BodyHTML}}
        <div id="content-html" class="tab-content p-6">
            <iframe
                sandbox="allow-same-origin"
                srcdoc="{{.Email.BodyHTML}}"
                class="w-full border border-gray-300 rounded"
                style="min-height: 500px"
                onload="this.style.height=(this.contentWindow.document.body.scrollHeight+20)+'px';"
            ></iframe>
        </div>
        {{end}}

        <div
            id="content-text"
            class="tab-content p-6 {{if .Email.BodyHTML}}hidden{{end}}"
        >
            {{if .Email.BodyText}}
            <pre class="whitespace-pre-wrap font-sans text-sm text-gray-900">
{{.Email.BodyText}}</pre
            >
            {{else}}
            <p class="text-gray-500 italic">No plain text content available</p>
            {{end}}
        </div>
    </div>

    <!-- Attachments -->
    {{if .Attachments}}
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">
            Attachments ({{len .Attachments}})
        </h2>
        <div class="space-y-2">
            {{range .Attachments}}
            <div
                class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"
            >
                <div class="flex items-center space-x-3">
                    <svg
                        class="w-8 h-8 text-gray-400"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"
                        />
                    </svg>
                    <div>
                        <p class="font-medium text-gray-900">{{.Filename}}</p>
                        <p class="text-sm text-gray-500">
                            {{.ContentType}}{{if .Size}} â€¢ {{.Size}}
                            bytes{{end}}
                        </p>
                    </div>
                </div>
                <a
                    href="/attachments/{{.ID}}/download"
                    download="{{.Filename}}"
                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium"
                    >Download</a
                >
            </div>
            {{end}}
        </div>
    </div>
    {{end}}
</div>

<script>
    function showTab(tabName) {
        document
            .querySelectorAll(".tab-content")
            .forEach((el) => el.classList.add("hidden"));
        document.querySelectorAll(".tab-button").forEach((el) => {
            el.classList.remove("border-blue-600", "text-blue-600");
            el.classList.add("border-transparent", "text-gray-500");
        });
        document
            .getElementById("content-" + tabName)
            .classList.remove("hidden");
        const activeTab = document.getElementById("tab-" + tabName);
        activeTab.classList.remove("border-transparent", "text-gray-500");
        activeTab.classList.add("border-blue-600", "text-blue-600");
    }
</script>

{{template "footer" .}}
